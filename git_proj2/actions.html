<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style type = "text/css">
/*
	Apr 15,2017 02:53
	dev by JB.
	
	지금 하다 끊긴것.	
	-	insertBefore forloop화.  // 이유: 보유 포켓몬이 증가할때마다 일일히 안되고 loop로 지속되야함.
    -	/////   ///// 사이에 까리하게 만들어보기.
	
	################################
	저번 이후 구현상황
	1. x키로 전투메뉴창으로 돌아가기.
	2. 몬스터도감시스템 (미완/ 상태이상, 체력상황 등등 상태유지되지않음..(prototype, pointing문제인듯.))
	3. 몬스터태그 시스템 - 포켓몬도감 -> 클릭후 confirm에서 확인누르면 현재 나가잇는몬스터와 선택몬스터와 태그.
 
	
	################################
	
*/
/*

###############
###	오늘내일(토,일) 진행작업.
	0.체력0이하일경우 -> 이겻다 졌다
	1.주인공캐릭터- 객체.(재화, 레벨-진입구간설정.)
	2.몬스터 객체 += 레벨, 건강상태(빈사, 출혈..등), 
	3.몬스터- 레벨링. 공+4, 방+1, 체+10 상승..  // optional) 주인공 버프?
	4.도망치기전 확인 div만들엇으면 좋겟다..
	
##	버그픽스: 가방뒤져보기 -> 공격하기 -> 가방뒤져보기 누르면... 메뉴로 돌아가기가 맨 첫 div로 display. 
	(아래메뉴 -> 윗메뉴 ->아래메뉴 식은 모두다 그럼..)
	
	
	optional) 
	1. 주인공 버프? 상대몬스터의 공방 30% 절감상태.
	4. 현재 상태와 지점 저장 (save load)
	
	추가예정
	0. 도망가기- 미완)화면연동. 도망쳐서 어떻게 도망치는 화면과 연동할수잇나.
	1. 시나리오 - 클릭이나 엔터, 스페이스 누를때(keyup) 다음 시나리오각본으로 이동.

*/



*{
border : 1px dotted red;

}
div{
	clear: right;
}


</style>

<script src = "http://code.jquery.com/jquery-1.10.2.js">
</script>
<script type = "text/javascript">
$(document).ready(function(){	
	this.onkeyup = function(event){  //
		 if(event.keyCode)
			console.log( String.fromCharCode(event.keyCode) +" : "+event.keyCode);
		 if(event.keyCode == 88){ // X누를때.
			 goBackToMenu();
		 }  
	}
	
});


function Pokemon(pokemonNo, name, monLevel, health, attackStr, shield, status){
	this.pokemonNo = pokemonNo;
	this.name = name; 
	this.monLevel = monLevel; 
	this.health = health;
	this.attackStr = attackStr;
	this.shield = shield;
	this.status = status;

}


/*
	2.몬스터 객체 += 레벨, 건강상태(빈사, 출혈..등), 
	3.몬스터- 레벨링. 공+4, 방+1, 체+15 상승..  // optional) 주인공 버프?  
 
*/
var pokemons =[];
pokemons.push(new Pokemon(0, "jbMon", 1, 50, 19, 3 ,"이상없음"));  
// pokemonNo monLevel name health attackStr shield status
pokemons.push(new Pokemon(1, "ynMon", 1, 60, 18, 6 ,"이상없음"));  // 포켓몬번호 이름 체력 기본공격력 기본방어력
pokemons.push(new Pokemon(2, "gyMon", 1, 43, 20, 3 ,"이상없음"));  // 일반공격이 1이면 스킬공격은 최소 1.2 최대1.7랜덤
pokemons.push(new Pokemon(3, "jwMon", 1, 54, 16, 4 ,"이상없음"));  //  pokemons[].pokemonNo
pokemons.push(new Pokemon(4, "jhMon", 1, 45, 22, 2 ,"이상없음"));  

var divGoBackToMenu = document.createElement("div");
divGoBackToMenu.innerHTML = "메뉴창으로";
divGoBackToMenu.setAttribute("id", "goBackToMenu_jb");

function goBackToMenu(){
	$("#attackOptions_jb, #bagOptions_jb, #pokeBookOptions_jb, #runAway_jb").css("display","block");
	$("#normalAtt_jb, #skillAtt_jb, #goBackToMenu_jb,  #bagMint_jb, #throwBall_jb, #meditation_jb," 
			+"#pokeId00, #pokeId01, #pokeId02, #pokeId03, #pokeId04").css("display","none");	
	
}
///////////////// Working Functions


function coolTimeCalc(){
	userTurn = (coolTime01> coolTime02)?  false : true;// 내 쿨타임이 더 큰경우 ; 상대턴.
	console.log("유저턴 확인하기: " + userTurn );
}

function tackle(){  	// 몸통박치기
	if(userTurn==false){		//상대방턴인경우
		this.health01 -= this.attackStr02;
		coolTime02 +=2;
		console.log("현재 내몬스터의 체력: "+this.health01 +" 쿨탐: "+ coolTime02);
	}
	else{	// 왠만하면 주인공 턴으로... 같거나 쿨탐적을경우.
		this.health02 -= this.attackStr01;
		coolTime01 +=2;
		console.log("현재 상대몬스터의 체력: "+this.health02 +" 쿨탐: "+ coolTime01);
	}
	showMove = "몸통박치기!";
	console.log(showMove);
	coolTimeCalc();
	
}

function skillAttack(){  // 스킬공격 
	var criticalAttack01 = Math.trunc(this.attackStr01*(1+(Math.random()*0.5 + 0.2))*100)/100 ; 
	var criticalAttack02 = Math.trunc(this.attackStr02*(1+(Math.random()*0.5 + 0.2))*100)/100 ; 
						// 스킬공격은 최대 1.5배 크리공격으로 할당. 소수점 2자리까지.
	if(userTurn==false){			//상대방턴인경우
		console.log( "깍이기전 체력: "+ this.health01);
		this.health01 -= (criticalAttack02 - this.shield01);  
			
		coolTime02 +=3;
		console.log("상대공격량"+criticalAttack02 + "내 방어량"+ this.shield01
				+"\n현재 내몬스터의 체력: "+this.health01 +" 쿨탐: "+ coolTime02);
		showMove = this.name02+"의 스킬공격!";
	}
	else{
		console.log( "깍이기전 체력: "+ this.health02);
		this.health02 -= (criticalAttack01 - this.shield02);
		coolTime01 +=3;
		console.log("내공격량"+criticalAttack01 + "상대 방어량"+this.shield02
				+"\n현재 상대몬스터의 체력: "+this.health02 +" 쿨탐: "+ coolTime01);
		showMove = this.name01+"의 스킬공격!";
	}
	console.log(showMove);
	coolTimeCalc();
}

function createAttOptionsOnce(){
	coolTimeCalc();
	if(userTurn == false){
		console.log("현재 당신의 턴이 아닙니다!"
				+"\n내 쿨탐= "+coolTime01+ " : 상대방쿨탐 = "+ coolTime02 );
		return;
	}
	$("#attackOptions_jb, #bagOptions_jb,#pokeBookOptions_jb,#runAway_jb").css("display","none"); 
	
	var normalAtt = document.createElement("div");
	var skillAtt = document.createElement("div");
	
//	normalAtt skillAtt
	if( $("#normalAtt_jb").html() == null){
		normalAtt.innerHTML = "몸통박치기!";
		normalAtt.setAttribute("id","normalAtt_jb");
		document.body.insertBefore(normalAtt, document.getElementById("bagOptions_jb"));	
		skillAtt.innerHTML = "스킬공격!";
		skillAtt.setAttribute("id", "skillAtt_jb");
		document.body.insertBefore(skillAtt, document.getElementById("bagOptions_jb"));	
		document.body.insertBefore(divGoBackToMenu, document.getElementById("bagOptions_jb"));	
	}

	normalAtt.onclick = function(){ tackle(); }
	skillAtt.onclick = function(){ skillAttack(); }
	divGoBackToMenu.onclick = function(){ goBackToMenu(); }  //divGoBackToMenu   , #goBackToMenu_jb 
	$("#normalAtt_jb, #skillAtt_jb, #goBackToMenu_jb").css({
		"display":"table-cell",
		"background":"#883050",
		"width":"150px", 
		"height": "50px", 
		"text-align":"center", 
		"vertical-align": "middle",
		"clear":"both"
	});
	$("#bagOptions_jb,#pokeBookOptions_jb,#runAway_jb").css("display","none");

}


function checkBaggage(toDo){ // (일단 주인공만)가방뒤지기 - turn소모없이 체력회복, 몬스터볼던지기, 명상하기 등..
	if(toDo =="mint"){
		console.log("민트먹기전: "+ this.health01);
		this.health01 += 25;  //민트먹고 체력 25회복. 아이템소모대신 쿨타임소모X
		showMove = this.name01 +"가 25만큼 회복!  현재체력:"+ this.health01;
	}
	else if(toDo =="catchWild"){
		var chanceToCatch = Math.trunc(Math.random()*0.6*100)/100;	
			//상대체력60%이하일때 운좋으면 잡기형식.	
		console.log("잡을확률"+chanceToCatch + 
				"\n체력비율" + (this.health02 / this.initEnemyHealth));
		if( (this.health02 / this.initEnemyHealth ) < chanceToCatch ){
			// 체력백분율보다 random이 더 클경우 잡기가능.
			this.health02 = 0 ;
			showMove = this.name02+"를 잡았다!";
		}
		else{  // 못잡을경우.
			coolTime01 +=3;
			showMove = this.name02+" 잡기 실패!";
		} 
	}// catchWild END.
	else if(toDo =="meditation"){ // 명상하고 체력 13회복. 쿨타임+1대신 아이템소모X 소량회복. 
		this.health01 += 13;
		coolTime01 +=1;
		showMove = this.name01+"명상하기! 현재체력: "+ this.health01;
	}
	console.log(showMove);
	coolTimeCalc();
}// checkBaggage END.



function createBagOptionsOnce(){
	coolTimeCalc();
 	if(userTurn == false){
 		console.log("현재 당신의 턴이 아닙니다!"
 				+"\n내 쿨탐= "+coolTime01+ " : 상대방쿨탐 = "+ coolTime02 );
 		return;
 	}
 	$("#attackOptions_jb, #bagOptions_jb,#pokeBookOptions_jb,#runAway_jb").css("display","none"); 
 	
	var divMint = document.createElement("div");  // createElement로 동적 div만들기. -민트먹기
	var divPkBall = document.createElement("div"); // createElement로 동적 div만들기. -포켓볼던지기
	var divMeditation = document.createElement("div"); // createElement로 동적 div만들기. -명상하기
	if( ($("#bagMint_jb").html() == null) ){
		divMint.innerHTML =" 민트먹기 ";
		divMint.setAttribute("id","bagMint_jb");
		document.body.insertBefore(divMint, document.getElementById("pokeBookOptions_jb") );	
	 	divPkBall.innerHTML =" 포켓볼 던지기 ";
		divPkBall.setAttribute("id","throwBall_jb");
		document.body.insertBefore(divPkBall, document.getElementById("pokeBookOptions_jb") );	
		divMeditation.innerHTML =" 명상하기 ";
		divMeditation.setAttribute("id","meditation_jb");
		document.body.insertBefore(divMeditation, document.getElementById("pokeBookOptions_jb") );	
		document.body.insertBefore(divGoBackToMenu, document.getElementById("pokeBookOptions_jb") );	
	}  
	

	divMint.onclick = function(){ checkBaggage("mint"); }
	divPkBall.onclick = function(){ checkBaggage("catchWild"); }
	divMeditation.onclick = function(){ checkBaggage("meditation"); }
	divGoBackToMenu.onclick = function(){ goBackToMenu(); }  //  divGoBackToMenu    , #goBackToMenu_jb  
	
	$("#bagMint_jb, #throwBall_jb, #meditation_jb, #goBackToMenu_jb").css({
		"display":"table-cell",
		"background":"lightblue",
		"width":"150px", 
		"height": "50px", 
		"text-align":"center", 
		"vertical-align": "middle",
	});
	
}




function escapeFromEnemy(){
	
}


function tagMyMon(obj){	
	/* console.log( parseInt(this.getAttribute("id").substr(this.getAttribute("id").length -2)) );
	console.log( window.pokemonNo02  ); */
	if(confirm("태그하시겟습니까?")){
		var chanceToChange = 0.3;  //######### 지금만설정
		console.log("몬스터에게도 거절의사가 잇다면? "+chanceToChange);
		if(chanceToChange < 0.4){ // 40%확률로 야생포켓몬과 만남. 
			turnMoves(parseInt(obj.getAttribute("id").substr(obj.getAttribute("id").length -2)), window.pokemonNo02);
			coolTime01 = 2;
			coolTime02 = 0;
		}
	}
	
}
///////////////////////////////////////////////////////////////////////////////
function checkPokemonStatus(idNum){
	// pokemonNo monLevel name health attackStr shield status
	
	console.log("=================");
	
	console.log("pokemonNo: "+ pokemons[idNum].pokemonNo);
	console.log("monLevel: "+ pokemons[idNum].monLevel);
	console.log("name: "+ pokemons[idNum].name);
	console.log("health: "+ pokemons[idNum].health);
	console.log("attackStr: "+ pokemons[idNum].attackStr);
	console.log("shield: "+ pokemons[idNum].shield);
	console.log("status: "+ pokemons[idNum].status);
	console.log("=================");
}
////////////////////////////////////////////////////////////////

//jb yn gy jw jh
function createPokemonStatusOnce(){
	 coolTimeCalc();
 	if(userTurn == false){
 		console.log("현재 당신의 턴이 아닙니다!"
 				+"\n내 쿨탐= "+coolTime01+ " : 상대방쿨탐 = "+ coolTime02 );
 		return;
 	}
 	$("#attackOptions_jb, #bagOptions_jb,#pokeBookOptions_jb,#runAway_jb").css("display","none"); 
 	
	var  pokeIniList = [];  //divNames 겸 idName
	var pokeIniListName = [];  // 메뉴에 보일 Names

	for(name in pokemons){
 		pokeIniList.push("div"+ pokemons[name].name);
 		pokeIniListName.push(pokemons[name].name + "몬!");
 	}
	pokeIniListName[pokeIniListName.length] = "뒤로뒤로!";
 //	console.log(pokeIniListName);
 
 	if($("#pokeId00").html() == null ){
		for(var inx = 0; inx <pokeIniList.length; inx++){  // inx = divJB, divYN....
			pokeIniList[inx] = document.createElement("div");
			pokeIniList[inx].innerHTML = pokeIniListName[inx];
			pokeIniList[inx].setAttribute("id","pokeId0"+pokemons[inx].pokemonNo);
			document.body.insertBefore(pokeIniList[inx], document.getElementById("runAway_jb") );
	
		}
		document.body.insertBefore(divGoBackToMenu, document.getElementById("runAway_jb") );	
	}
 
 
////////////////////////////////////////////////////////////////////////////
 /* 	for(var inx = 0; inx <pokeIniList.length; inx++){  // inx = divJB, divYN....
		$("#pokeId0"+pokemons[inx].pokemonNo+"").unbind().click(function(){ 
 		$(this).css("background","black");
			

 		});     // 이건또 왜 돼는가..??  
 	} */ 
/* 	for(var inx = 0; inx <pokeIniList.length; inx++){  // inx = divJB, divYN....

	  	$("#pokeId0"+inx).unbind().click(function(){ checkPokemonStatus(inx); });  
		

	} */ ///// 이건또 왜 안돼는가..??
 	
			
/* 		console.log( parseInt(this.getAttribute("id").substr(this.getAttribute("id").length -2)) );
		console.log( window.name02 ); */

   	$("#pokeId00").unbind().click(function(){ 
  		checkPokemonStatus(0); 
  		tagMyMon(this);
  	});   
	$("#pokeId01").unbind().click(function(){ 
		checkPokemonStatus(1); 
  		tagMyMon(this);
		});
	$("#pokeId02").unbind().click(function(){ 
		checkPokemonStatus(2); 
  		tagMyMon(this);
		});
	$("#pokeId03").unbind().click(function(){ 
		checkPokemonStatus(3); 
  		tagMyMon(this);
		});
	$("#pokeId04").unbind().click(function(){ 
		checkPokemonStatus(4); 
  		tagMyMon(this);
		});   
	$("#goBackToMenu_jb").unbind().click(function(){ 
		goBackToMenu(); 
		}); 
	
	
	$("#pokeId00,#pokeId01,#pokeId02,#pokeId03,#pokeId04, #goBackToMenu_jb").css({
		"display":"table-cell",
		"background":"limegreen",
		"width":"100px", 
		"height": "50px", 
		"text-align":"center", 
		"vertical-align": "middle",
	});
	 ////////////////////////##################### 불량: 나중에 몬스터볼로 잡고 div생겨야하므로 loop화가 필수!!
	 ////////////////////////////////////////////////////////////////////////////

		//jb yn gy jw jh
 
 
	
}


////////////////////
//////////////////// main action options.
////////////////////
var userTurn = true;
var coolTime01 = 0; //유저쿨타임.
var coolTime02 = 0;	
var showMove ="";

function turnMoves( myMon, enemyMon  ){   // ###야생 포켓몬 만난후 메인콘솔창.
	
// 이것들은 누적됨!! 체력, 레벨, 상태이상  쭉쭉!
// pokemonNo monLevel name health attackStr shield status

	this.pokemonNo01 = pokemons[myMon].pokemonNo;  // 몬스터번호 선언
	this.pokemonNo02 = pokemons[enemyMon].pokemonNo;  
	this.monLevel01 = pokemons[myMon].monLevel;  // 몬스터레벨 선언
	this.monLevel02 = pokemons[enemyMon].monLevel;  

	this.name01 = pokemons[myMon].name;  // 이름 선언
	this.name02 = pokemons[enemyMon].name;
	this.health01 = pokemons[myMon].health; // 체력 선언
	this.health02 = pokemons[enemyMon].health;
	this.initEnemyHealth = pokemons[enemyMon].health;  // 상대초기체력할당. ->몬볼로 잡을떄 체력%구하려고..
	this.attackStr01 = pokemons[myMon].attackStr; // 공격력 선언
	this.attackStr02 = pokemons[enemyMon].attackStr;
	this.shield01 = pokemons[myMon].shield;  // 방어력선언
	this.shield02 = pokemons[enemyMon].shield;
	
	this.status01 = pokemons[myMon].status;  // 몬스터상태 선언
	this.status02 = pokemons[enemyMon].status;  

	userTurn = coolTime01 > coolTime02 ? false : true;
	
	console.log("나: "+ pokemons[myMon].name + "상대: "+pokemons[enemyMon].name );

	$("#attackOptions_jb").unbind().click(function(){ 
		createAttOptionsOnce();
	});

	$("#bagOptions_jb").unbind().click(function(){ 
		createBagOptionsOnce();  //createElement 한번만 부르기위한...
	});
	
	$("#pokeBookOptions_jb").unbind().click(function(){ 
		createPokemonStatusOnce();  //createElement 한번만 부르기위한...
	});
	
	$("#runAway_jb").unbind().click(function(){
		
		////#### 도망치기전 확인 div만들엇으면 좋겟다..
		
		
		goBackToMenu();
		console.log(" 성공적으로 도망쳤다! ");
		
		
		console.log(" 새로운 몬스터를 만났다!!!======== ");
		
		encountChance = 0.3;  //######### 지금만설정
		console.log(encountChance);
		if(encountChance < 0.4){ // 40%확률로 야생포켓몬과 만남. 
			var randPokemon = parseInt(Math.random()*4 +1);
			turnMoves(0,randPokemon);   // 일단 0번포켓몬 주인공, 상대는 랜덤으로..### 전투모드 돌입!!!
			coolTime01 =0;
			coolTime02 =0;
		}
		

		
		  //위에서 아래로읽는바람에... 셋다 한번에 읽게 만드는방법???###### null if elseif check!!

	});
	
	 
	
} //turnMoves END
 


////////////////////////////
////////////////////////////playing game.
////////////////////////////

window.onload = function(){

	var encountChance = Math.random();
	encountChance = 0.3;  //######### 지금만설정
	console.log(encountChance);
	if(encountChance < 0.4){ // 40%확률로 야생포켓몬과 만남. 
		var randPokemon = parseInt(Math.random()*4 +1);
		turnMoves(0,randPokemon);   // 일단 0번포켓몬 주인공, 상대는 랜덤으로..### 전투모드 돌입!!!
	}

		
}





</script>

</head>
<body>
<h3 id= "attackOptions_jb">공격하기</h3>
<h3 id= "bagOptions_jb">가방뒤져보기</h3>
<h3 id= "pokeBookOptions_jb">포켓몬도감 살펴보기</h3>
<h3 id= "runAway_jb">도망치기!</h3>
</body>
</html>




